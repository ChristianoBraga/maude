#!/usr/bin/env bash

export PATH="/usr/lib/ccache/bin:$PATH"
export PATH="/usr/lib/ccache:$PATH"

top_dir="$(pwd)"
build_dir="$top_dir/.build"
include_dir="$build_dir/include"
lib_dir="$build_dir/lib"

git submodule update --init

( cd src/SMT/cvc4 \
    && ./autogen.sh \
    && ./contrib/get-antlr-3.4 \
    && ./configure --prefix=$build_dir \
                   --with-antlr-dir=$(pwd)/antlr-3.4 ANTLR=$(pwd)/antlr-3.4/bin/antlr3 \
    && make -s -j4 \
    && make -s install )

automake --add-missing

aclocal \
    && autoconf \
    && autoheader \
    && automake \
    && ./configure CXXFLAGS="-I$include_dir -L$lib_dir" "$@" \
    && make -s -j4

git checkout -- src/Mixfix/surface.cc

make -s -j4
